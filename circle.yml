machine:
  services:
    - docker
dependencies:
  override:
    - npm install
    - npm install -g webpack
  post:
    - mkdir -p ~/.aws
    - envsubst < .aws/credentials.template > ~/.aws/credentials
    - envsubst < .aws/config.template > ~/.aws/config
test:
  override:
    - echo 'test'
deployment:
  release:
    branch: master
    commands:
      - webpack
      - aws s3 sync dist/ s3://stat.arimit.su/browsing-beacon/versions/${CIRCLE_SHA1}/
  publish:
    tag: /.*/
    commands:
      - aws s3 sync s3://stat.arimit.su/browsing-beacon/versions/${CIRCLE_SHA1}/ s3://stat.arimit.su/browsing-beacon/tags/${CIRCLE_TAG}/
      - aws s3 sync s3://stat.arimit.su/browsing-beacon/versions/${CIRCLE_SHA1}/ s3://stat.arimit.su/browsing-beacon/
